<form class="modal-content" id="metric-form" style="width: 30em;">
	<div class="modal-header">
		<h4 class="modal-title">Metric</h4>
	</div>
	<div class="modal-body">
		<input type="text" style="display: none;" id="metricId" data-value="id">
		<div class="form-group">
			<label for="metricName">Name</label> 
			<input required minlength="3" maxlength="255" type="text" data-value="name" class="form-control" id="metricName" name="name" placeholder="Metric Name">
		</div>
		<div class="form-group">
			<label for="metricDescription">Description</label> 
			<input maxlength="255" type="text" data-value="description" class="form-control" id="metricDescription" placeholder="Description for the Metric">
		</div>
		<div class="form-group">
			<label for="abbreviation">Abbreviation</label> 
			<input required minlength="1" maxlength="10" type="text" data-value="abbreviation" class="form-control" id="abbreviation" placeholder="Abbreviation for the measurement Unit">
		</div>
		<div class="form-group">
			<label for="metricUnit">Unit</label> 
			<input required maxlength="255" type="text" data-value="unit" class="form-control" id="metricUnit" placeholder="Measurement unit for this metric">
		</div>
		<div class="form-group">
			<label for="dataType">Data Type</label> 
			<select data-value="dataType" class="form-control" id="dataType">
				<option selected="selected">NUMBER</option>
				<option>BOOLEAN</option>
				<option>TEXT</option>
			</select>
		</div>
	</div>
	<div class="modal-footer">
		<a id="metricEditorCancelButton" href="#" class="btn btn-secondary">
			<span class="fa fa-trash"></span> Cancel
		</a>
		<button type="submit" id="metricEditorSaveButton" href="#" class="btn btn-primary">
			<span class="fa fa-save"></span> Save
		</button>
	</div>
</form>
<script>
	renderModal = (function($){
		var inputMetric = null;
		var inputMetrics = null;
		var metricCallback = null;
		var nameValidationArray = null;
		$("#metricName").focus();
		
		$("#metric-form").validate({
			messages:{
				name: {
					notInArray: "Another metric exists with same name"
				}
			},			
			rules:{
				name: {
					notInArray : {
						provider: function(){
							return nameValidationArray;
						}
					}
				}
			},			
			submitHandler: function(){
				toModel(inputMetric);
				$.modal.close();
				if(metricCallback){
			    	metricCallback();
			    }
			}	
		});
		
		var bindEventHandlers = function(){
			$("#metricEditorCancelButton").click(function (event) {
				event.preventDefault();
			    $.modal.close();
			});
		};
		
		var toView = function(metric){
			if(metric){
				$("#metricId").val(metric.id);
				$("#metricName").val(metric.name);
				$("#metricDescription").val(metric.description);
				$("#abbreviation").val(metric.abbreviation);
				$("#metricUnit").val(metric.unit);
				$("#dataType").val(metric.dataType);	
			}
		};
		
		var toModel = function(metric){
			metric.id = $("#metricId").val();
			metric.name= $("#metricName").val();
			metric.description= $("#metricDescription").val();
			metric.abbreviation= $("#abbreviation").val();
			metric.unit= $("#metricUnit").val();
			metric.dataType= $("#dataType").val();
		};
		
		return function(metric, metrics, callback){
			inputMetric = metric;
			inputMetrics = metrics;
			metricCallback = callback;
			toView(metric);
			bindEventHandlers();
			
			nameValidationArray = inputMetrics ? inputMetrics.map(m => m.name) : [];
			var index = nameValidationArray.indexOf(inputMetric.name);
			if(index > -1){
				nameValidationArray.splice(index, 1);	
			}
		};
	})(jQuery);
</script>