<div class="card">
    <div class="card-body">
        <table id="templates" class="table table-bordered table-striped" style="width: 100%">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Inactivity Period</th>
                    <th>Description</th>
                    <th>Tags</th>
                    <th>
                        <a href="#templates/0" class="btn btn-primary btn-sm" id="newTemplateButton">
                            <span class="fa fa-plus"></span> New Template
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<script type="text/javascript">
	render = (function($){
		var templatesDataTable = null;
		
		 var showViewTemplateModal = function (event, source, originalEvent, id) {
			 source.blur();
			 originalEvent.preventDefault();
	        $.publish("show-template-view-modal", id);
	    };
		
		var showDeleteTemplateConfirmationModal = function(event, element, originalEvent, id){
			element.blur();
			originalEvent.preventDefault();
			row = templatesDataTable.row("#" + id);
	        $.publish("show-confirmation-modal", [{
	            message: "Are you sure you want to delete template " + row.data().name + " ?"
	        }, function () {
	            templateService.deleteById(id, function () {
	                row.remove().draw();
	                $.modal.close();
	            });
	        }]);
		};
		
		var showTemplatesDataTable = function(){
			templateService.findAll(function (templates) {
		        templatesDataTable = $("#templates").DataTable({
		            rowId: "id",
		            language: {
		                processing: "Loading ..."
		            },
		            processing: true,
		            columns: [
		                {
		                    data: "name",
		                    mRender: function (data, type, row) {
		                        return '<a href="#" onclick="$(\'#templates\').trigger(\'view-template\', [this, event,'+row.id+']);">' + data + '</a>';
		                    }
		                },
		                { data: "inactivityPeriod" },
		                { data: "description" },
		                { data: "tags" },
		                {
		                    mRender: function (data, type, row, meta) {
		                        return '<div class="btn-group" role="group">' +
		                            '<a class="btn btn-warning btn-xs" href="#templates/' + row.id + '">' +
		                                '<span class="fa fa-edit"></span> Edit' +
		                            '</a>' +
		                            '<button type="button" class="btn btn-danger btn-xs" onclick="$(\'#templates\').trigger(\'delete-template\', [this, event,'+row.id+'])">' +
		                            	'<span class="fa fa-trash"></span> Delete' +
		                            '</button>' +
		                            '</div>';
		                    }
		                }],
		            columnDefs: [{
		                targets: -1,
		                orderable: false,
		                className: "text-center"
		            }],
		            data: templates
		        });
		    });
		};
		
		return function(){
			$("#page-title").html("Templates");
			showTemplatesDataTable();
			$("#templates").on("view-template", showViewTemplateModal);
			$("#templates").on("delete-template", showDeleteTemplateConfirmationModal);
		}
	})(jQuery);

</script>