<form class="card" id="template-form">
    <div class="card-body">

        <table style="width:100%">
            <tr>
                <td width="33.33%" style="padding: 0 1em 0 0;">
                    <input type="text" style="display:none;" id="templateId">
                    <div class="form-group">
                        <label for="templateName">Name</label>
                        <input required minlength="3" maxlength="255" class="form-control" id="templateName" data-value="name" placeholder="Template Name">
                    </div>
                    <div class="form-group">
                        <label for="templateDescription">Description</label>
                        <input maxlength="255" type="text" class="form-control" id="templateDescription" data-value="description"
                            placeholder="Template Description">
                    </div>

                </td>
                <td width="33.33%" style="padding: 0 1em 0 1em;">
                    <div class="form-group">
                        <label for="templateTags">Tags</label>
                        <input type="text" class="form-control" id="templateTags" data-value="tags" placeholder="Tags (type and press Enter)">
                    </div>
                    <div class="form-group">
                        <label for="inactivityPeriod">Inactivity Period</label>
                        <input required digits min="60" type="text" class="form-control" id="inactivityPeriod" data-value="inactivityPeriod"
                            placeholder="Inactivity Period (in seconds)">
                    </div>
                </td>
                <td width="33.33%" style="padding: 0 0 0 1em;">
                    <div class="form-group">
                        <label for="templateProperties">Properties</label>
                        <textarea maxlength="255" placeholder="key=value" class="form-control" id="templateProperties" data-value="properties"
                            data-format="MapFormatter" data-format-target="value" rows="5"></textarea>
                    </div>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <h3>
                        Metrics
                    </h3>
                    <table id="metrics-table" class="table table-striped table-bordered table-sm" style="width:100%;">
                        <thead>
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Abbreviation</th>
                                <th scope="col">Unit</th>
                                <th scope="col">Data Type</th>
                                <th scope="col">Description</th>
                                <th scope="col">
                                    <button class="btn btn-primary btn-sm" id="newMetricBtn">
                                        <span class="fa fa-plus"></span> New Metric
                                    </button>
                                </th>
                            </tr>
                        </thead>
                    </table>
                </td>
            </tr>
        </table>

        <div class="button-bar">
            <a href="#" id="cancelButton" class="btn btn-secondary">
                <i class="fa fa-trash"></i> Cancel
            </a>
            <button type="submit" href="#" id="saveButton" class="btn btn-primary">
                <i class="fa fa-save"></i> Save
            </button>
        </div>


    </div>
</form>



<script>
    $("#cancelButton").click(function () {
        window.history.back();
    });
    $("#template-form").validate({
    	submitHandler: function(form, event){
    		
    	}
    });

    var metricsData = null;
    var metricsDataTable = null;
    var showMetricsDataTable = function (metrics) {
        metricsData = metrics;
        metricsDataTable = $("#metrics-table").DataTable({
            rowId: "id",
            searching: false,
            ordering: false,
            paging: false,
            info: false,
            data: metrics,
            columnDefs: [{
                targets: -1,
                className: "text-center"
            }],
            columns: [
                { data: "name" },
                { data: "abbreviation" },
                { data: "unit" },
                { data: "dataType" },
                { data: "description" },
                {
                    render: function (data, type, full, meta) {
                        return '<div class="btn-group" role="group">' +
                            '<button type="button" class="btn btn-warning btn-xs" onclick="showMatricEditorModal(this, event, ' + meta.row + ');">' +
                            '<span class="fa fa-edit"></span> Edit' +
                            '</button>' +
                            '<button type="button" class="btn btn-danger btn-xs">' +
                            '<span class="fa fa-trash"></span> Delete' +
                            '</button>' +
                            '</div>';
                    }
                }
            ]
        });
    }

    $("#newMetricBtn").click(function () {
        showMetricEditView(null);
    });

    var showMatricEditorModal = function (source, event, index) {
        event.preventDefault();
        source.blur();
        metric = metricsDataTable.row(index).data();
        showMetricEditView(metric);
    }

    var showMetricEditView = function (metric) {
        $("#modal-container").loadTemplate("pages/metrics/edit.html", metric, {
            success: function () {
                metricEditorModal = $("#modal-container").modal({
                    closeExisting: false
                });
                $("#metricEditorSaveButton").click(function () {
                    if (metric) {
                        populateMetric(metric);
                    } else {
                        newMetric = {};
                        populateMetric(newMetric);
                        metricsData.push(newMetric);
                    }
                    metricsDataTable.clear().rows.add(metricsData).draw();
                    $.modal.close();
                });
            }
        });
    }

</script>